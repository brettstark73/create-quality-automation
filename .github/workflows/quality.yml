name: Quality Checks (Minimal)

# Minimal CI workflow - Local pre-push hooks handle most checks
# This is a safety net for critical validations only
#
# WORKFLOW_MODE: minimal
#
# What runs here:
# - Full test suite (unit + integration + E2E)
# - Build verification
# - Weekly security scan (gitleaks + npm audit)
#
# What runs locally (pre-push hook):
# - Linting (ESLint, Stylelint)
# - Formatting (Prettier)
# - Fast unit tests
# - Secret scanning (gitleaks)
# - Dependency audit (npm audit)
# - XSS pattern detection

on:
  push:
    branches: [main, master] # Only main branch to save minutes
    # PATH_FILTERS_PLACEHOLDER
  pull_request:
    branches: [main, master]
  # SECURITY_SCHEDULE_PLACEHOLDER

# Prevent duplicate runs
concurrency:
  group: quality-${{ github.workflow }}-${{ github.ref }}
  cancel-in-progress: true

jobs:
  # Main validation job - tests + build
  test-and-build:
    runs-on: ubuntu-latest
    # MATRIX_PLACEHOLDER

    steps:
      - name: Checkout code
        uses: actions/checkout@v6
        with:
          fetch-depth: 0

      - name: Setup Node.js
        uses: actions/setup-node@v6
        with:
          node-version: ${{ matrix.node-version || '22' }}
          cache: 'npm'

      - name: Install dependencies
        run: npm ci

      - name: Run tests
        # TESTS_CONDITION_PLACEHOLDER
        run: npm test || exit 1

      - name: Verify build
        run: npm run build || exit 1

      - name: Verify package signatures
        run: npm audit signatures || echo "⚠️ Signature verification not available"
        continue-on-error: true

  # Weekly security scan (safety net)
  weekly-security:
    if: github.event_name == 'schedule'
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v6
        with:
          fetch-depth: 0

      - name: Setup Node.js
        uses: actions/setup-node@v6
        with:
          node-version: '22'

      - name: Gitleaks scan
        uses: gitleaks/gitleaks-action@v2
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

      - name: Dependency audit
        run: npm audit --audit-level=high || exit 1
